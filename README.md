# SMTS
Secure Messenger with Transparent Server on Python

Безопасный мессенджер с end-to-end шифрованием, где сервер выступает только в роли "прозрачного" посредника, не хранящего ни сообщений, ни файлов, ни криптографических ключей (всё что нам обещал Паша Дуров, но не обеспечил).

## Ключевые особенности

- **End-to-end шифрование**: Все сообщения и файлы шифруются на стороне клиента перед отправкой
- **Прозрачный сервер**: Сервер только пересылает данные, не имея доступа к их содержимому
- **Безопасный обмен ключами**: Используется алгоритм Диффи-Хеллмана (2048 бит) для установления защищённого канала
- **Функционал**:
  - Подтверждение целостности соединения (fingerprint ключей)
  - Обмен приватными сообщениями и файлами (до 10Мб)
  - Широковещательные сообщения и файлы
  
### Клиентская часть (`mes_client.py`)
  - Предоставляет пользовательский интерфейс с командной строкой
  - Устанавливает защищённое соединение (DH key exchange)
  - Осуществляет шифрование/дешифрование сообщений и файлов (AES-256-CBC)
  
- Используемые технологии:
  - `PyCryptodome` для криптографических операций
  - Сокеты для сетевого взаимодействия
  - Потоки для асинхронного получения сообщений

### Серверная часть (`mes_server.py`)

- Выполняет только функции маршрутизации
- Серверна часть НЕ хранит:
  - Сообщения
  - Файлы
  - Криптографические ключи
  - Историю соединений
- Генерирует временные ID для клиентов при подключении

## Команды клиента

```
/connect [client_id]     - Начать обмен ключами
/msg [client_id] [text]  - Отправить приватное сообщение
/send [client_id] [file] - Отправить приватный файл
/bmsg [text]             - Широковещательное сообщение
/bsend [file]            - Широковещательная отправка файла
/list                    - Список активных соединений
/exit                    - Выход
/help                    - Справка по командам
```

## Установка и запуск

1. Установите зависимости:
```bash
pip install pycryptodome
```

2. Запустите сервер (для доступа из любой точки в сети Интернет используйте сервер с публичным IP:
```bash
python mes_server.py
```

3. Запустите клиент(ы):
```bash
python mes_client.py
```

## Особенности безопасности

- Ключи генерируются на стороне клиентов
- После отключения клиента ключ безвозвратно теряется (невозможно дешифровать трафик, если он был кем-то перехвачен)
- Сервер никак не участвует в процессе шифрования (нет никаких мастер-ключей и тому подобной дичи)
- Используются проверенные криптографические алгоритмы
- Подтверждение ключей через fingerprint (первые 8 символов хеша)
- Автоматическая проверка целостности данных


## Важные моменты:
- В клиенте и сервере укажите одинаковый HANDSHAKE ( self.handshake_secret = "SECRET_HANDSHAKE_KEY" )
- Нет удобного механизма аутентификации и представления пользователей (только ID клиентов, но это и анонимнее)
- Нет истории сообщений
- Максимальный размер файла - 10MB (этот ограничение можно перенастроить под свои задачи)
- Для работы требуется, чтобы сервер был доступен всем клиентам (имел публичный IP или находился в той же сети, где находятся все клиенты)

## Скриншот взаимодействия трёх клиентов подключенных к удалённому серверу

<img width="2540" height="994" alt="securechat" src="https://github.com/user-attachments/assets/6f001268-7df7-417b-8d9b-4774d2ada872" />

## Работает замечательно и на андроиде через Pydroid

![androidpy](https://github.com/user-attachments/assets/1d23293a-7430-4761-858d-a7901dcbe2f1)

